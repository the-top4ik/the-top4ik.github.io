<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Теми які я вивчив у ШАГ</title>
	<link rel="shortcut icon" type="image/x-icon" href="img/ШАГ.jpeg">
	<style>
		body {
			background-image: url(img/правило.jpg);
			background-repeat: no-repeat;
			background-position: center;
		}
	</style>
</head>
<body style="margin: 0;">

	

<canvas id="canvas" style="display: block;">Я хочу вивчити JS.JavaScript</canvas>

	<script>
		var
			canv  = document.getElementById('canvas'),
			ctx		= canv.getContext('2d');
			isMouseDown = false;
			coords = [];

		canv.width = window.innerWidth;
		canv.height = window.innerHeight;

		// Code

		canv.addEventListener('mousedown', function() {
			isMouseDown = true;
		})

		canv.addEventListener('mouseup', function() {
			isMouseDown = false;
			ctx.beginPath();
			coords.push('mouseup')
		})

		ctx.lineWidth = 10 * 2;
		canv.addEventListener('mousemove', function(e) {

			if( isMouseDown  )
			{
			coords.push([e.clientX, e.clientY]);

			ctx.lineTo(e.clientX, e.clientY);
			ctx.stroke();

			ctx.beginPath();
			ctx.arc(e.clientX, e.clientY, 10, 0, Math.PI * 2);
			ctx.fill();

			ctx.beginPath();
			ctx.moveTo(e.clientX, e.clientY);
			}
			
		})

		function save()
		{
			localStorage.setItem('coords', JSON.stringify(coords));
		}

		function clear()
		{
			ctx.fillStyle = 'white';
			ctx.fillRect(0, 0, canv.width, canv.height);

			ctx.beginPath();
			ctx.fillStyle = 'black'
		}

		function replay()
		{
			var
				timer = setInterval(function() {
					if( !coords.length )
					{
						clearInterval(timer);
						ctx.beginPath();
						return;
					}

					var
						crd = coords.shift(),
						e = {
							clientX: crd["0"],
							clientY: crd["1"]
						};
					ctx.lineTo(e.clientX, e.clientY);
					ctx.stroke();

					ctx.beginPath();
					ctx.arc(e.clientX, e.clientY, 10, 0, Math.PI * 2);
					ctx.fill();

					ctx.beginPath();
					ctx.moveTo(e.clientX, e.clientY);
				}, 20)
		}

		document.addEventListener('keydown', function(e) {
			if( e.keyCode == 83)
			{
				// save
				save();
				console.log('Saved')
			}
			if( e.keyCode == 82)
			{
				// replay
				console.log('Replayni ...')

				coords = JSON.parse(localStorage.getItem('coords'));

				clear();
				replay();
			}
			if( e.keyCode == 67)
			{
				// clear
				clear();
				console.log('Cleared')
			}
		});

	</script>

</body>
</html>